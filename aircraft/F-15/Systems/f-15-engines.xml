<?xml version="1.0"?>

<!--
        Description: F-15 F-100 engines
        Author: Richard Harrison (rjh@zaretto.com)
        References: 
        1. J79-15/-17 TURBOJET ENGINE ACCIDENT INVESTIGATION PROCEDURES ASD-TR-75-19
        2. NASA TM-86042 Minimum Time and Fuel Flight Profiles for an F-15 Airplane with a Highly Integrated Digital Electronic Control System. Edward A. Haering, Jr., and Frank W. Burcham, Jr.
        3. NASA TP-1069 Airflow and thrust calibration of an F100 Engine S/N p680059 at selected flight conditions. Thomas J.  Biesiadny,  Douglas  Lee,  and Jose  R.  Rodriguez 
        3. NASA TP-1228 Altitude calibration of an F100 Engine S/N p680063, Turbofan Engine. Thomas J.  Biesiadny,  Douglas  Lee,  and Jose  R.  Rodriguez 
        
        Currently this is calculating the EGT and Burn thru only; using the JSBSim model for the rest.
    -->

<system name="ENGINES">
    <channel name="engine-control">

        <scheduled_gain name="ThrottleL">
            <input>fcs/throttle-pos-norm[0]</input>
            <table>
                <independentVar>fcs/throttle-pos-norm[0]</independentVar>
                <tableData>
                    <!-- 5 stage non linear augmentation-->
                    0.00    0.0
                    0.8999  0.999
                    0.91    1.0
                    0.93    1.25
                    0.95    1.50
                    0.97    1.75
                    1.00    2.0
                </tableData>
            </table>
            <output>fcs/throttle-pos-norm[0]</output>
        </scheduled_gain>

        <scheduled_gain name="ThrottleR">
            <input>fcs/throttle-pos-norm[1]</input>
            <table>
                <independentVar>fcs/throttle-pos-norm[1]</independentVar>
                <tableData>
                    <!-- 5 stage non linear augmentation-->
                    0.00    0.0
                    0.8999  0.999
                    0.91    1.0
                    0.93    1.25
                    0.95    1.50
                    0.97    1.75
                    1.00    2.0
                </tableData>
            </table>
            <output>fcs/throttle-pos-norm[1]</output>
        </scheduled_gain>
    </channel>
    <channel name="engine-limits-damage">

        <fcs_function name="propulsion/openv-mn-must-be-above">
            <description>F100 operating envelope - MN must be above</description>
            <function>
                <table>
                    <independentVar lookup="row">position/h-sl-ft</independentVar>
                    <tableData>
                        0                   0
                        3281                0
                        6562                0
                        9843                0
                        13123               0
                        16404               0
                        19685               0
                        22966               0.041195
                        26247               0.101788
                        29528               0.162382
                        32808               0.222975
                        36089               0.283568
                        39370               0.344161
                        42651               0.404755
                        45932               0.465348
                        49213               0.525941
                        52494               0.586534
                        55774               0.647127
                        59055               0.707721
                        62336               0.768314
                        65617               0.828907
                        68898               0.889500
                        72179               1.130490
                        73819               2.493650
                        80000               2.493650
                    </tableData>
                </table>
            </function>
        </fcs_function>
        <fcs_function name="propulsion/openv-mn-must-be-below">
            <description>F100 operating envelope - MN must be below</description>
            <function>
                <table>
                    <independentVar lookup="row">position/h-sl-ft</independentVar>
                    <tableData>
                        0                   1.233490
                        3281                1.315350
                        6562                1.397200
                        9843                1.479060
                        13123               1.560920
                        16404               1.642780
                        19685               1.724640
                        22966               1.848510
                        26247               1.979740
                        29528               2.110970
                        32808               2.230080
                        36089               2.325410
                        39370               2.420750
                        42651               2.489280
                        45932               2.489720
                        49213               2.490150
                        52494               2.490590
                        55774               2.491030
                        59055               2.491470
                        62336               2.491900
                        65617               2.492340
                        68898               2.492780
                        72179               2.493220
                        75459               2.493650
                        80000               2.493650
                    </tableData>
                </table>
            </function>
        </fcs_function>
        <fcs_function name="propulsion/openv-underspeed">
            <description>Exceeded maximum speed as defined by operational envelope</description>
            <function>
                <sum>
                    <property>propulsion/openv-underspeed</property>
                    <product>
                        <ifthen>
                            <lt>
                                <property>velocities/mach</property>
                                <property>propulsion/openv-mn-must-be-above</property>
                            </lt>
                            <value>1</value>
                            <value>-1</value>
                        </ifthen>
                        <value>0.1</value>
                        <property>simulation/channel-dt</property>
                    </product>
                </sum>
            </function>
            <clipto>
                <min>0</min>
                <max>1</max>
            </clipto>
        </fcs_function>

        <fcs_function name="propulsion/openv-overspeed">
            <description>Exceeded maximum speed as defined by operational envelope</description>
            <function>
                <sum>
                    <property>propulsion/openv-overspeed</property>
                    <product>
                        <ifthen>
                            <gt>
                                <property>velocities/mach</property>
                                <property>propulsion/openv-mn-must-be-below</property>
                            </gt>
                            <value>1</value>
                            <value>-1</value>
                        </ifthen>
                        <value>0.005556</value>
                        <property>simulation/channel-dt</property>
                    </product>
                </sum>
            </function>
            <clipto>
                <min>0</min>
                <max>5</max>
            </clipto>
        </fcs_function>
        <switch name="propulsion/openv-total-temp-too-high">
            <default value="0" />
            <test value="1">
                propulsion/openv-overspeed ge 1
            </test>
        </switch>
      

        <fcs_function name="propulsion/fire-extinguishers-armed-count">
            <function>
                <sum>
                    <property>propulsion/engine[0]/fire-button-armed</property>
                    <property>propulsion/engine[1]/fire-button-armed</property>
                    <property>propulsion/amad-fire-button-armed</property>
                </sum>
            </function>
        </fcs_function>

        <fcs_function name="propulsion/engine[0]/bleedair-temp-val">
            <description>
                PB is the only pressure ratio (from ambient) at the burner
                and this is close enough to where the bleed air is taken to give
                us a pressure to work with.
                Temperature ratio is pressure ratio ^ (gamma-1)/gamma
                where gamma is the ratio of specific heats.
                T2 / T1 = (p2 / pt1) ^ ((gamma -1) / gamma)
                sigma 0.09 M4 @60000
            </description>
            <function>
                <product>
                    <ifthen>
                        <gt>
                            <property>propulsion/openv-overspeed</property>
                            <value>1.0</value>
                        </gt>
                        <product>
                            <property>propulsion/openv-overspeed</property>
                            <property>propulsion/openv-overspeed</property>
                        </product>
                        <value>1</value>
                    </ifthen>
                    <property>propulsion/engine[0]/PB</property>
                    <property>atmosphere/T-R</property>
                </product>
            </function>
        </fcs_function>
        <lag_filter name="propulsion/engine[0]/bleedair-temp">
            <input>propulsion/engine[0]/bleedair-temp-val</input>
			<c1>0.1</c1>
        </lag_filter>
        <switch name="propulsion/engine[0]/bleedair-temp-high">
            <default value="0" />
            <test value="1">
                propulsion/engine[0]/bleedair-temp gt 2000
            </test>
        </switch>

        <!-- 
        1 TOT-TEMP-HIGH (3 minute) FIg 3-8 sheet 1 
        2 L BLEED AIR (overtemp) 
        2 R BLEED AIR (overtemp)
        3 L R BURN THRU (abrupt increase in temp in aft keel/boom area 
        4 AMAD FIRE 
        5 L R ENG FIRE 
        -->
        <fcs_function name="propulsion/engine[0]/seized">
            <function>
                <ifthen>
                    <nq>
                        <property>propulsion/damage-reset</property>
                        <v>0</v>
                    </nq>
                    <v>0</v>
                    <ifthen>
                        <and>
                            <ge>
                                <property>propulsion/openv-overspeed</property>
                                <value>5</value>
                            </ge>
                            <gt>
                                <property>propulsion/engine[0]/PB</property>
                                <value>1.6</value>
                            </gt>
                        </and>
                        <value>1</value>
                        <property>propulsion/engine[0]/seized</property>
                    </ifthen>
                </ifthen>
            </function>
        </fcs_function>
        <switch name="propulsion/engine[0]/fire">
            <default value="propulsion/engine[0]/fire" />
            <test value="1">
                propulsion/engine[0]/seized ne 0
            </test>
            <test value="0" logic="OR">
                propulsion/engine[0]/fire-extinguished ne 0
                propulsion/damage-reset ne 0
            </test>
        </switch>
        <fcs_function name="propulsion/engine[0]/fire-intensity">
            <function>
                <ifthen>
                    <or>
                        <lt>
                            <property>propulsion/engine[0]/fire</property>
                            <value>1</value>
                        </lt>
                        <nq>
                            <property>propulsion/engine[0]/fire-extinguished</property>
                            <value>0</value>
                        </nq>
                    </or>
                    <value>0</value>
                    <sum>
                        <property>propulsion/engine[0]/fire-intensity</property>
                        <product>
                            <property>simulation/channel-dt</property>
                            <value>0.001667</value> <!-- ~ 10 minutes for full fire. -->
                        </product>
                    </sum>
                </ifthen>
            </function>
            <clipto>
                <min>0</min>
                <max>1</max>
            </clipto>
        </fcs_function>
        <fcs_function name="propulsion/engine[0]/fire-extinguished">
            <function>
                <ifthen>
                    <nq>
                        <property>propulsion/damage-reset</property>
                        <v>0</v>
                    </nq>
                    <v>0</v>
                    <ifthen>
                        <and>
                            <eq>
                                <property>propulsion/fire-discharge-mode</property>
                                <value>2</value>
                            </eq>
                            <gt>
                                <property>propulsion/engine[0]/fire-button-armed</property>
                                <value>0</value>
                            </gt>
                            <gt>
                                <property>propulsion/engine[0]/fire</property>
                                <value>0</value>
                            </gt>
                            <ge>
                                <property>propulsion/fire-extinguisher-level</property>
                                <value>1</value>
                            </ge>
                        </and>
                        <lt>
                            <quotient>
                                <property>propulsion/engine[0]/fire-intensity</property>
                                <sum>
                                    <property>propulsion/engine[0]/fire-button-armed</property>
                                    <property>propulsion/engine[1]/fire-button-armed</property>
                                    <property>propulsion/amad-fire-button-armed</property>
                                </sum>
                            </quotient>
                            <!-- 
                                the chance of the fire being extinguised will be 
                                based on the number of elements (L,R,AMAD) discharged 
                                and the intensity of the fire
                                so the formula
                                is intensity / (number of buttons) 
                                so with an intensity of 1.0 being the max 
                                the fire will be extinguishable during the first three minutes
                                however with three first it will only work in the first minute.
                            -->
                            <value>1.3</value>
                        </lt>
                        <property>propulsion/engine[0]/fire-extinguished</property>
                    </ifthen>
                </ifthen>
            </function>
            <clipto>
                <min>0</min>
                <max>1</max>
            </clipto>
        </fcs_function> 
        
        <switch name="propulsion/engine[0]/overtemp">
            <default value="0" />
            <test value="1">
                propulsion/openv-overspeed gt 1.5
            </test>
        </switch>
        <switch name="propulsion/engine[0]/blowout">
            <default value="0" />
            <test value="1">
                propulsion/openv-underspeed ge 0.4
            </test>
        </switch>
        <switch name="propulsion/engine[0]/stalled">
            <default value="0" />
            <test value="1">
                propulsion/openv-underspeed ge 1
            </test>
        </switch>

        <!-- engine 1-->
        <fcs_function name="propulsion/engine[1]/bleedair-temp-val">
            <description>
                PB is the only pressure ratio (from ambient) at the burner
                and this is close enough to where the bleed air is taken to give
                us a pressure to work with.
                Temperature ratio is pressure ratio ^ (gamma-1)/gamma
                where gamma is the ratio of specific heats.
                T2 / T1 = (p2 / pt1) ^ ((gamma -1) / gamma)
                sigma 0.09 M4 @60000
            </description>
            <function>
                <product>
                    <ifthen>
                        <gt>
                            <property>propulsion/openv-overspeed</property>
                            <value>1.0</value>
                        </gt>
                        <product>
                            <property>propulsion/openv-overspeed</property>
                            <property>propulsion/openv-overspeed</property>
                        </product>
                        <value>1</value>
                    </ifthen>
                    <property>propulsion/engine[1]/PB</property>
                    <property>atmosphere/T-R</property>
                </product>
            </function>
        </fcs_function>
        <lag_filter name="propulsion/engine[1]/bleedair-temp">
            <input>propulsion/engine[1]/bleedair-temp-val</input>
			<c1>0.1</c1>
        </lag_filter>
        <switch name="propulsion/engine[1]/bleedair-temp-high">
            <default value="0" />
            <test value="1">
                propulsion/engine[1]/bleedair-temp gt 2000
            </test>
        </switch>

        <!-- 
        1 TOT-TEMP-HIGH (3 minute) FIg 3-8 sheet 1 
        2 L BLEED AIR (overtemp) 
        2 R BLEED AIR (overtemp)
        3 L R BURN THRU (abrupt increase in temp in aft keel/boom area 
        4 AMAD FIRE 
        5 L R ENG FIRE 
        -->
        <fcs_function name="propulsion/engine[1]/seized">
            <function>
                <ifthen>
                    <nq>
                        <property>propulsion/damage-reset</property>
                        <v>0</v>
                    </nq>
                    <v>0</v>
                    <ifthen>
                        <and>
                            <ge>
                                <property>propulsion/openv-overspeed</property>
                                <value>5</value>
                            </ge>
                            <gt>
                                <property>propulsion/engine[1]/PB</property>
                                <value>1.6</value>
                            </gt>
                        </and>
                        <value>1</value>
                        <property>propulsion/engine[1]/seized</property>
                    </ifthen>
                </ifthen>
            </function>
        </fcs_function>
        <switch name="propulsion/engine[1]/fire">
            <default value="propulsion/engine[1]/fire" />
            <test value="1">
                propulsion/engine[1]/seized ne 0
            </test>
            <test value="0" logic="OR">
                propulsion/engine[1]/fire-extinguished ne 0
                propulsion/damage-reset ne 0
            </test>
        </switch>
        <fcs_function name="propulsion/engine[1]/fire-intensity">
            <function>

                <ifthen>
                    <or>
                        <lt>
                            <property>propulsion/engine[1]/fire</property>
                            <value>1</value>
                        </lt>
                        <nq>
                            <property>propulsion/engine[1]/fire-extinguished</property>
                            <value>0</value>
                        </nq>
                    </or>
                    <value>0</value>
                    <sum>
                        <property>propulsion/engine[1]/fire-intensity</property>
                        <product>
                            <property>simulation/channel-dt</property>
                            <value>0.001667</value> <!-- ~ 10 minutes for full fire. -->
                        </product>
                    </sum>
                </ifthen>
            </function>
            <clipto>
                <min>0</min>
                <max>1</max>
            </clipto>
        </fcs_function>
        <fcs_function name="propulsion/engine[1]/fire-extinguished">
            <function>
                <ifthen>
                    <nq>
                        <property>propulsion/damage-reset</property>
                        <v>0</v>
                    </nq>
                    <v>0</v>
                    <ifthen>
                        <and>
                            <eq>
                                <property>propulsion/fire-discharge-mode</property>
                                <value>2</value>
                            </eq>
                            <gt>
                                <property>propulsion/engine[1]/fire-button-armed</property>
                                <value>0</value>
                            </gt>
                            <gt>
                                <property>propulsion/engine[1]/fire</property>
                                <value>0</value>
                            </gt>
                            <ge>
                                <property>propulsion/fire-extinguisher-level</property>
                                <value>1</value>
                            </ge>
                        </and>
                        <lt>
                            <quotient>
                                <property>propulsion/engine[1]/fire-intensity</property>
                                <sum>
                                    <property>propulsion/engine[1]/fire-button-armed</property>
                                    <property>propulsion/engine[1]/fire-button-armed</property>
                                    <property>propulsion/amad-fire-button-armed</property>
                                </sum>
                            </quotient>
                            <!-- 
                                the chance of the fire being extinguised will be 
                                based on the number of elements (L,R,AMAD) discharged 
                                and the intensity of the fire
                                so the formula
                                is intensity / (number of buttons) 
                                so with an intensity of 1.0 being the max 
                                the fire will be extinguishable during the first three minutes
                                however with three first it will only work in the first minute.
                            -->
                            <value>1.3</value>
                        </lt>
                        <property>propulsion/engine[1]/fire-extinguished</property>
                    </ifthen>
                </ifthen>
            </function>
            <clipto>
                <min>0</min>
                <max>1</max>
            </clipto>
        </fcs_function> 
        
        <switch name="propulsion/engine[1]/overtemp">
            <default value="0" />
            <test value="1">
                propulsion/openv-overspeed gt 1.5
            </test>
        </switch>
        <switch name="propulsion/engine[1]/blowout">
            <default value="0" />
            <test value="1">
                propulsion/openv-underspeed ge 0.4
            </test>
        </switch>
        <switch name="propulsion/engine[1]/stalled">
            <default value="0" />
            <test value="1">
                propulsion/openv-underspeed ge 1
            </test>
        </switch>
    </channel>

    <channel name="F100-L">
        <fcs_function name="propulsion/engine[0]/c-egt-lead">
            <description>EGT LEAD N1 %</description>
            <function>
                <table>
                    <independentVar lookup="row">propulsion/engine[0]/n1</independentVar>
                    <tableData>
                        0	18.2
                        10	12.7
                        24	8.45
                        42	5.25
                        56	4.77
                        100	4.4
                    </tableData>
                </table>
            </function>
        </fcs_function >
        <fcs_function name="propulsion/engine[0]/c-egt-lag">
            <description>EGT LAG N1 %</description>
            <function>
                <table>
                    <independentVar lookup="row">propulsion/engine[0]/n1</independentVar>
                    <tableData>
                        0	3.20
                        10	2.15
                        24	0.99
                        42	0.56
                        56	0.25
                        100	0.21
                    </tableData>
                </table>
            </function>
        </fcs_function >

        <fcs_function name="propulsion/engine[0]/fuel-flow-rate-norm">
            <description>Fuel Flow normalized</description>
            <function>
                <quotient>
                    <property>propulsion/engine[0]/fuel-flow-rate-pps</property>
                    <value>3</value>
                </quotient>
            </function>
            <clipto>
                <min>0</min>
                <max>1.43</max>
            </clipto>
        </fcs_function>

        <fcs_function name="propulsion/engine[0]/EGT-C-dmd">
            <description>Engine 0 EGT Degrees C</description>
            <function>
                <table>
                    <independentVar lookup="row">velocities/mach</independentVar>
                    <independentVar lookup="column">propulsion/engine[0]/fuel-flow-rate-norm</independentVar>
                    <tableData>
                        0	0.001	0.009	0.02	0.03	0.04	0.05	0.06	0.07	0.08	0.1	0.12	0.14	0.16	0.2	0.24	0.32	0.4	0.56	0.8	0.984
                        0	0	271	281	292	301	310	319	328	336	344	359	374	387	400	424	447	492	537	641	808	870
                        0.2	0	268	277	288	297	307	315	324	332	340	355	369	383	395	419	442	486	531	633	798	860
                        0.3	0	260	269	279	288	297	306	314	322	330	344	358	371	383	406	428	471	515	614	774	833
                        0.5	0	249	257	267	276	285	293	301	308	316	330	343	355	367	389	410	451	493	588	741	798
                        0.6	0	232	240	250	258	266	274	281	288	295	308	320	332	343	364	383	421	460	549	692	746
                        0.8	0	216	223	232	240	247	254	261	268	274	286	298	308	319	338	356	391	428	510	643	693
                        0.9	0	208	215	223	231	238	245	251	258	264	275	286	297	307	325	343	377	412	491	619	667
                    </tableData>
                </table>
            </function>
        </fcs_function>

        <!-- Augmentation 
         The augmentation has a five stage burner; with high voltage ignition. Sufficient pressure at the ignitor is required and
         this is performed by the augmentation control system on the engine. As soon as there is sufficient pressure, regardless of the compressor
         rpm the augmentor can fire. 
      -->
        <fcs_function name="propulsion/engine[0]/PB">
            <description>Engine 0 SS Burner pressure ratio</description>
            <function>
                <table>
                    <independentVar lookup="row">propulsion/engine[0]/n2</independentVar>
                    <independentVar lookup="column">velocities/mach</independentVar>
                    <tableData>
                            0.00000 0.20000 0.30000 0.45000 0.60000 0.80000 0.90000 3.00000
                        0	1.00000	0.93963	0.93963	0.93963	0.93963	0.93963	0.93963	0.93963
                        8	1.09966	0.93963	0.93963	0.93963	0.93963	0.93963	0.93963	0.93963
                        16	1.26926	0.97069	0.93186	0.93963	0.93963	0.93963	0.93963	0.93963
                        24	1.37453	0.99197	0.95229	0.92944	0.93963	0.93963	0.93963	0.93963
                        32	1.56636	1.00992	0.96952	0.92105	0.89341	0.93963	0.93963	0.93963
                        40	1.87550	1.03223	0.99094	0.94140	0.91316	0.91316	0.93963	0.93963
                        48	2.25353	1.06785	1.02514	0.95338	0.91524	0.91835	0.97369	0.97369
                        56	2.61381	1.12695	1.08188	1.00614	0.96590	0.96918	0.97369	0.97369
                        63	2.84760	1.22096	1.17212	1.09007	1.04647	1.05002	0.99630	0.99630
                        71	2.98150	1.34177	1.28810	1.19793	1.15002	1.15392	1.09488	1.09488
                        79	3.00594	1.53633	1.47488	1.37164	1.31677	1.32124	1.25365	1.25365
                        87	3.07269	1.80555	1.73333	1.61200	1.54752	1.55278	1.47333	1.47333
                        95	3.49481	2.16568	2.07905	1.93352	1.85618	1.86248	1.76719	1.76719
                        97	3.71122	2.63418	2.52881	2.35179	2.25772	2.26539	2.14949	2.14949
                        98	3.84257	2.77040	2.65959	2.47341	2.37448	2.38255	2.26065	2.26065
                        100	4.15840	2.84159	2.72792	2.53697	2.43549	2.44376	2.31873	2.31873
                    </tableData>
                </table>
            </function>
        </fcs_function>
        <fcs_function name="propulsion/engine[0]/augmentation-stage">
            <function>
                <integer>
                    <sum>
                        <value>1.0</value>
                        <product>
                            <sum>
                                <property>fcs/throttle-pos-norm[0]</property>
                                <value>-1</value>
                            </sum>
                            <value>5</value>
                        </product>
                    </sum>
                </integer>
            </function>
            <clipto>
                <min>0</min>
                <max>5</max>
            </clipto>
        </fcs_function>
        <switch name="propulsion/engine[0]/augmentation-ignition">
            <default value="0"/>
            <test value="1">
                propulsion/engine[0]/PB gt 2.14
                propulsion/engine[0]/augmentation-stage gt 0
                propulsion/engine[0]/augmentation-alight eq 0
            </test>
        </switch>
        <switch name="propulsion/engine[0]/augmentation-igniting">
            <default value="0"/>
            <test value="1">
                propulsion/engine[0]/augmentation-ignition gt 0
                propulsion/engine[0]/augmentation-alight eq 0
            </test>
        </switch>

        <!--<lag_filter name="propulsion/engine[0]/augmentation-alight">
            <input></input>
            <output>propulsion/engine[0]/augmentation-alightC</output>
            <c1>0.001</c1>
        </lag_filter >-->
        <actuator name="propulsion/engine[0]/augmentation-ignition-sequence">
            <input> propulsion/engine[0]/augmentation-igniting </input>
            <rate_limit> 1.2 </rate_limit>
            <clipto>
                <min> 0 </min>
                <max>  1</max>
            </clipto>
        </actuator>

        <switch name="propulsion/engine[0]/augmentation-alight-dmd">
            <default value="0" />
            <test value="propulsion/engine[0]/augmentation-stage">
                propulsion/engine[0]/augmentation-stage ne propulsion/engine[0]/augmentation-alight
                propulsion/engine[0]/augmentation-alight ne 0
                propulsion/engine[0]/thrust-lbs gt 100 <!-- engine alight -->
            </test>
            <test value="propulsion/engine[0]/augmentation-stage">
                propulsion/engine[0]/augmentation-ignition-sequence gt 0.9
                propulsion/engine[0]/thrust-lbs gt 100 <!-- engine alight -->
            </test>
            <test value="propulsion/engine[0]/augmentation-alight">
                propulsion/engine[0]/augmentation-stage gt 0
                propulsion/engine[0]/augmentation-alight ne 0
                propulsion/engine[0]/thrust-lbs gt 100 <!-- engine alight -->
            </test>
            <test value="0">
                propulsion/engine[0]/blowout ne 0
            </test>
        </switch>
        <switch name="propulsion/engine[0]/augmentation-burner">
            <default value="0"/>
            <test value="1">
                propulsion/engine[0]/augmentation-alight ne 0
                propulsion/engine[0]/thrust-lbs gt 100 <!-- engine alight -->
            </test>
            <test value="propulsion/engine[0]/augmentation-ignition-sequence">
                propulsion/engine[0]/augmentation-ignition-sequence ne 0
                propulsion/engine[0]/thrust-lbs gt 100 <!-- engine alight -->
            </test>
        </switch>
        <!--<fcs_function name="propulsion/engine[0]/augmentation-alight-delta">
            <function>
                <difference>
                    <property>propulsion/engine[0]/augmentation-alight</property>
                    <property>propulsion/engine[0]/augmentation-alight-dmd</property>
                </difference>
            </function>
            <clipto>
                <min>0</min>
                <max>5</max>
            </clipto>
        </fcs_function>-->
        <actuator name="propulsion/engine[0]/augmentation-alight">
            <input> propulsion/engine[0]/augmentation-alight-dmd </input>
            <rate_limit> 10 </rate_limit>
            <clipto>
                <min> 0 </min>
                <max>  5</max>
            </clipto>
        </actuator>
        <fcs_function name="propulsion/engine[0]/augmentation-alight-v">
            <function>
                <sum>
                    <property>propulsion/engine[0]/augmentation-alight</property>
                    <v>0</v>
                </sum>
            </function>
        </fcs_function>
        <!-- EGT equations -->
        <fcs_function name="propulsion/engine[0]/EGTaug-C-dmd">
            <description>Engine 0 EGT increment due to augmentation</description>
            <function>
                <table>
                    <independentVar lookup="row">propulsion/engine[0]/augmentation-stage</independentVar>
                    <tableData>
                        0.00	0
                        1.00	86
                        5.00	171
                    </tableData>
                </table>
            </function>
        </fcs_function>

        <lag_filter name="propulsion/engine[0]/EGTaug-C">
            <input>propulsion/engine[0]/EGTaug-C-dmd</input>
            <output>propulsion/engine[0]/EGTaug-C</output>
            <c1>0.03</c1>
        </lag_filter >
        <fcs_function name="propulsion/engine[0]/EGT-R-dmd">
            <description>EGT Demand degrees R</description>
            <function>
                <product>
                    <sum>
                        <property>propulsion/engine[0]/EGT-C-dmd</property>
                        <property>propulsion/engine[0]/EGTaug-C</property>
                        <value>273</value>
                    </sum>
                    <value>1.8</value>
                </product>
            </function>
        </fcs_function>
        <fcs_function name="propulsion/engine[0]/pt">
            <description>Total Pressure</description>
            <function>
                <!--double pt = Math.Pow(pambient * (1.0 + 0.2 * velocities_mach * velocities_mach), 3.5);-->
                <pow>
                    <product>
                        <product>
                            <property>atmosphere/P-psf</property>
                            <value>144</value>
                        </product>
                        <sum>
                            <value>1.0</value>
                            <product>
                                <value>0.2</value>
                                <property>velocities/mach</property>
                                <property>velocities/mach</property>
                            </product>
                        </sum>
                    </product>
                    <value>3.5</value>
                </pow>
            </function>
        </fcs_function>
        <fcs_function name="propulsion/engine[0]/delta">
            <description>Delta</description>
            <function>
                <quotient>
                    <property>propulsion/engine[0]/pt</property>
                    <value>14.696</value>
                </quotient>
            </function>
        </fcs_function>

        <lead_lag_filter name="propulsion/engine[0]/EGT-R">
            <input>propulsion/engine[0]/EGT-R-dmd</input>
            <output>propulsion/engine[0]/EGT-R</output>
            <c1>propulsion/engine[0]/delta</c1>
            <c2>propulsion/engine[0]/c-egt-lead</c2>
            <c3>propulsion/engine[0]/delta</c3>
            <c4>propulsion/engine[0]/c-egt-lead</c4>
        </lead_lag_filter >
        <lag_filter name="propulsion/engine[0]/casing-temperature-R">
            <input>propulsion/engine[0]/EGT-R</input>
            <output>propulsion/engine[0]/casing-temperature-R</output>
            <c1>0.01</c1>
        </lag_filter>
        <switch name="propulsion/engine[0]/burn-thru">
            <default value="0"/>
            <test value="1">
                propulsion/engine[0]/casing-temperature-R gt 1965
            </test>
        </switch>
        <!-- augmentation -->
        <fcs_function name="propulsion/engine[0]/alt/nozzle-dmd-norm">
            <function>
                <description>PLA Vs Nozzle open area Exhaust Nozzle Control TO 15-15A-1 page 1-8 </description>
                <table>
                    <independentVar lookup="row">fcs/throttle-pos-norm[0]</independentVar>
                    <tableData>
                        0.0 	0.81807
                        0.2235	0.81807
                        1.0000	0.15248
                    </tableData>
                </table>
            </function>
        </fcs_function>

        <switch name="propulsion/engine[0]/alt/nozzle-cmd-norm">
            <default value="propulsion/engine[0]/alt/nozzle-dmd-norm"/>
            <test value="1.0" logic="OR">
                propulsion/engine[0]/augmentation-alight gt 0
                propulsion/engine[0]/augmentation-ignition gt 0.4
                propulsion/engine[0]/n2 lt 60
            </test>
        </switch>
        <kinematic name="propulsion/engine[0]/alt/nozzle-pos-norm">
            <input>propulsion/engine[0]/alt/nozzle-cmd-norm</input>
            <traverse>
                <setting>
                    <position>0</position>
                    <time>1</time>
                </setting>
                <setting>
                    <position>1</position>
                    <time>0.4</time>
                </setting>
            </traverse>
        </kinematic>
        <!-- a/b lighting envelope; use outside of this envelope will increase risk of blowout-->
    </channel>

    <channel name="F100-R">
        <fcs_function name="propulsion/engine[1]/c-egt-lead">
            <description>EGT LEAD N1 %</description>
            <function>
                <table>
                    <independentVar lookup="row">propulsion/engine[1]/n1</independentVar>
                    <tableData>
                        0	18.2
                        10	12.7
                        24	8.45
                        42	5.25
                        56	4.77
                        100	4.4
                    </tableData>
                </table>
            </function>
        </fcs_function >
        <fcs_function name="propulsion/engine[1]/c-egt-lag">
            <description>EGT LAG N1 %</description>
            <function>
                <table>
                    <independentVar lookup="row">propulsion/engine[1]/n1</independentVar>
                    <tableData>
                        0	3.20
                        10	2.15
                        24	0.99
                        42	0.56
                        56	0.25
                        100	0.21
                    </tableData>
                </table>
            </function>
        </fcs_function >

        <fcs_function name="propulsion/engine[1]/fuel-flow-rate-norm">
            <description>Fuel Flow normalized</description>
            <function>
                <quotient>
                    <property>propulsion/engine[1]/fuel-flow-rate-pps</property>
                    <value>3</value>
                </quotient>
            </function>
            <clipto>
                <min>0</min>
                <max>1.43</max>
            </clipto>
        </fcs_function>

        <fcs_function name="propulsion/engine[1]/EGT-C-dmd">
            <description>Engine 0 EGT Degrees C</description>
            <function>
                <table>
                    <independentVar lookup="row">velocities/mach</independentVar>
                    <independentVar lookup="column">propulsion/engine[1]/fuel-flow-rate-norm</independentVar>
                    <tableData>
                        0	0.001	0.009	0.02	0.03	0.04	0.05	0.06	0.07	0.08	0.1	0.12	0.14	0.16	0.2	0.24	0.32	0.4	0.56	0.8	0.984
                        0	0	271	281	292	301	310	319	328	336	344	359	374	387	400	424	447	492	537	641	808	870
                        0.2	0	268	277	288	297	307	315	324	332	340	355	369	383	395	419	442	486	531	633	798	860
                        0.3	0	260	269	279	288	297	306	314	322	330	344	358	371	383	406	428	471	515	614	774	833
                        0.5	0	249	257	267	276	285	293	301	308	316	330	343	355	367	389	410	451	493	588	741	798
                        0.6	0	232	240	250	258	266	274	281	288	295	308	320	332	343	364	383	421	460	549	692	746
                        0.8	0	216	223	232	240	247	254	261	268	274	286	298	308	319	338	356	391	428	510	643	693
                        0.9	0	208	215	223	231	238	245	251	258	264	275	286	297	307	325	343	377	412	491	619	667
                    </tableData>
                </table>
            </function>
        </fcs_function>

        <!-- Augmentation 
         The augmentation has a five stage burner; with high voltage ignition. Sufficient pressure at the ignitor is required and
         this is performed by the augmentation control system on the engine. As soon as there is sufficient pressure, regardless of the compressor
         rpm the augmentor can fire. 
      -->
        <fcs_function name="propulsion/engine[1]/PB">
            <description>Engine 0 SS Burner pressure ratio</description>
            <function>
                <table>
                    <independentVar lookup="row">propulsion/engine[1]/n2</independentVar>
                    <independentVar lookup="column">velocities/mach</independentVar>
                    <tableData>
                        0.00000	0.20000	0.30000	0.45000	0.60000	0.80000	0.90000	3.00000
                        0	1.00000	0.93963	0.93963	0.93963	0.93963	0.93963	0.93963	0.93963
                        8	1.09966	0.93963	0.93963	0.93963	0.93963	0.93963	0.93963	0.93963
                        16	1.26926	0.97069	0.93186	0.93963	0.93963	0.93963	0.93963	0.93963
                        24	1.37453	0.99197	0.95229	0.92944	0.93963	0.93963	0.93963	0.93963
                        32	1.56636	1.00992	0.96952	0.92105	0.89341	0.93963	0.93963	0.93963
                        40	1.87550	1.03223	0.99094	0.94140	0.91316	0.91316	0.93963	0.93963
                        48	2.25353	1.06785	1.02514	0.95338	0.91524	0.91835	0.97369	0.97369
                        56	2.61381	1.12695	1.08188	1.00614	0.96590	0.96918	0.97369	0.97369
                        63	2.84760	1.22096	1.17212	1.09007	1.04647	1.05002	0.99630	0.99630
                        71	2.98150	1.34177	1.28810	1.19793	1.15002	1.15392	1.09488	1.09488
                        79	3.00594	1.53633	1.47488	1.37164	1.31677	1.32124	1.25365	1.25365
                        87	3.07269	1.80555	1.73333	1.61200	1.54752	1.55278	1.47333	1.47333
                        95	3.49481	2.16568	2.07905	1.93352	1.85618	1.86248	1.76719	1.76719
                        97	3.71122	2.63418	2.52881	2.35179	2.25772	2.26539	2.14949	2.14949
                        98	3.84257	2.77040	2.65959	2.47341	2.37448	2.38255	2.26065	2.26065
                        100	4.15840	2.84159	2.72792	2.53697	2.43549	2.44376	2.31873	2.31873
                    </tableData>
                </table>
            </function>
        </fcs_function>
        <fcs_function name="propulsion/engine[1]/augmentation-stage">
            <function>
                <integer>
                    <sum>
                        <value>1.0</value>
                        <product>
                            <sum>
                                <property>fcs/throttle-pos-norm[1]</property>
                                <value>-1</value>
                            </sum>
                            <value>5</value>
                        </product>
                    </sum>
                </integer>
            </function>
            <clipto>
                <min>0</min>
                <max>5</max>
            </clipto>
        </fcs_function>
        <switch name="propulsion/engine[1]/augmentation-ignition">
            <default value="0"/>
            <test value="1">
                propulsion/engine[1]/PB gt 2.14
                propulsion/engine[1]/augmentation-stage gt 0
                propulsion/engine[1]/augmentation-alight eq 0
            </test>
        </switch>
        <switch name="propulsion/engine[1]/augmentation-igniting">
            <default value="0"/>
            <test value="1">
                propulsion/engine[1]/augmentation-ignition gt 0
                propulsion/engine[1]/augmentation-alight eq 0
            </test>
        </switch>

        <!--<lag_filter name="propulsion/engine[1]/augmentation-alight">
            <input></input>
            <output>propulsion/engine[1]/augmentation-alightC</output>
            <c1>0.001</c1>
        </lag_filter >-->
        <actuator name="propulsion/engine[1]/augmentation-ignition-sequence">
            <input> propulsion/engine[1]/augmentation-igniting </input>
            <rate_limit> 1.2 </rate_limit>
            <clipto>
                <min> 0 </min>
                <max>  1</max>
            </clipto>
        </actuator>

        <switch name="propulsion/engine[1]/augmentation-alight-dmd">
            <default value="0"/>
            <test value="propulsion/engine[1]/augmentation-stage">
                propulsion/engine[1]/augmentation-stage ne propulsion/engine[1]/augmentation-alight
                propulsion/engine[1]/augmentation-alight ne 0
                propulsion/engine[1]/thrust-lbs gt 100 <!-- engine alight -->
            </test>
            <test value="propulsion/engine[1]/augmentation-stage">
                propulsion/engine[1]/augmentation-ignition-sequence gt 0.9
                propulsion/engine[1]/thrust-lbs gt 100 <!-- engine alight -->
            </test>
            <test value="propulsion/engine[1]/augmentation-alight">
                propulsion/engine[1]/augmentation-stage gt 0
                propulsion/engine[1]/augmentation-alight ne 0
                propulsion/engine[1]/thrust-lbs gt 100 <!-- engine alight -->
            </test>
            <test value="0">
                propulsion/engine[1]/blowout ne 0
            </test>
        </switch>
        <switch name="propulsion/engine[1]/augmentation-burner">
            <default value="0"/>
            <test value="1">
                propulsion/engine[1]/augmentation-alight ne 0
                propulsion/engine[1]/thrust-lbs gt 100 <!-- engine alight -->
            </test>
            <test value="propulsion/engine[1]/augmentation-ignition-sequence">
                propulsion/engine[1]/augmentation-ignition-sequence ne 0
                propulsion/engine[1]/thrust-lbs gt 100 <!-- engine alight -->
            </test>
        </switch>
        <!--<fcs_function name="propulsion/engine[1]/augmentation-alight-delta">
            <function>
                <difference>
                    <property>propulsion/engine[1]/augmentation-alight</property>
                    <property>propulsion/engine[1]/augmentation-alight-dmd</property>
                </difference>
            </function>
            <clipto>
                <min>0</min>
                <max>5</max>
            </clipto>
        </fcs_function>-->
        <actuator name="propulsion/engine[1]/augmentation-alight">
            <input> propulsion/engine[1]/augmentation-alight-dmd </input>
            <rate_limit> 10 </rate_limit>
            <clipto>
                <min> 0 </min>
                <max>  5</max>
            </clipto>
        </actuator>
        <fcs_function name="propulsion/engine[1]/augmentation-alight-v">
            <function>
                <sum>
                    <property>propulsion/engine[1]/augmentation-alight</property>
                    <v>0</v>
                </sum>
            </function>
        </fcs_function>
        <!-- EGT equations -->
        <fcs_function name="propulsion/engine[1]/EGTaug-C-dmd">
            <description>Engine 0 EGT increment due to augmentation</description>
            <function>
                <table>
                    <independentVar lookup="row">propulsion/engine[1]/augmentation-stage</independentVar>
                    <tableData>
                        0.00	0
                        1.00	86
                        5.00	171
                    </tableData>
                </table>
            </function>
        </fcs_function>

        <lag_filter name="propulsion/engine[1]/EGTaug-C">
            <input>propulsion/engine[1]/EGTaug-C-dmd</input>
            <output>propulsion/engine[1]/EGTaug-C</output>
            <c1>0.03</c1>
        </lag_filter >
        <fcs_function name="propulsion/engine[1]/EGT-R-dmd">
            <description>EGT Demand degrees R</description>
            <function>
                <product>
                    <sum>
                        <property>propulsion/engine[1]/EGT-C-dmd</property>
                        <property>propulsion/engine[1]/EGTaug-C</property>
                        <value>273</value>
                    </sum>
                    <value>1.8</value>
                </product>
            </function>
        </fcs_function>
        <fcs_function name="propulsion/engine[1]/pt">
            <description>Total Pressure</description>
            <function>
                <!--double pt = Math.Pow(pambient * (1.0 + 0.2 * velocities_mach * velocities_mach), 3.5);-->
                <pow>
                    <product>
                        <product>
                            <property>atmosphere/P-psf</property>
                            <value>144</value>
                        </product>
                        <sum>
                            <value>1.0</value>
                            <product>
                                <value>0.2</value>
                                <property>velocities/mach</property>
                                <property>velocities/mach</property>
                            </product>
                        </sum>
                    </product>
                    <value>3.5</value>
                </pow>
            </function>
        </fcs_function>
        <fcs_function name="propulsion/engine[1]/delta">
            <description>Delta</description>
            <function>
                <quotient>
                    <property>propulsion/engine[1]/pt</property>
                    <value>14.696</value>
                </quotient>
            </function>
        </fcs_function>

        <lead_lag_filter name="propulsion/engine[1]/EGT-R">
            <input>propulsion/engine[1]/EGT-R-dmd</input>
            <output>propulsion/engine[1]/EGT-R</output>
            <c1>propulsion/engine[1]/delta</c1>
            <c2>propulsion/engine[1]/c-egt-lead</c2>
            <c3>propulsion/engine[1]/delta</c3>
            <c4>propulsion/engine[1]/c-egt-lead</c4>
        </lead_lag_filter >
        <lag_filter name="propulsion/engine[1]/casing-temperature-R">
            <input>propulsion/engine[1]/EGT-R</input>
            <output>propulsion/engine[1]/casing-temperature-R</output>
            <c1>0.01</c1>
        </lag_filter>
        <switch name="propulsion/engine[1]/burn-thru">
            <default value="0"/>
            <test value="1">
                propulsion/engine[1]/casing-temperature-R gt 1965
            </test>
        </switch>
        <!-- augmentation -->
        <fcs_function name="propulsion/engine[1]/alt/nozzle-dmd-norm">
            <function>
                <description>PLA Vs Nozzle open area Exhaust Nozzle Control TO 15-15A-1 page 1-8 </description>
                <table>
                    <independentVar lookup="row">fcs/throttle-pos-norm[1]</independentVar>
                    <tableData>
                        0.0 	0.81807
                        0.2235	0.81807
                        1.0000	0.15248
                    </tableData>
                </table>
            </function>
        </fcs_function>

        <switch name="propulsion/engine[1]/alt/nozzle-cmd-norm">
            <default value="propulsion/engine[1]/alt/nozzle-dmd-norm"/>
            <test value="1.0" logic="OR">
                propulsion/engine[1]/augmentation-alight gt 0
                propulsion/engine[1]/augmentation-ignition gt 0.4
                propulsion/engine[1]/n2 lt 60
            </test>
        </switch>
        <kinematic name="propulsion/engine[1]/alt/nozzle-pos-norm">
            <input>propulsion/engine[1]/alt/nozzle-cmd-norm</input>
            <traverse>
                <setting>
                    <position>0</position>
                    <time>1</time>
                </setting>
                <setting>
                    <position>1</position>
                    <time>0.4</time>
                </setting>
            </traverse>
        </kinematic>

    </channel>
</system>